---
title: "Logboek_SV"
author: "Stijn Vermeulen"
date: "2024-11-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introductie

I will create a Data dashboard from data that discripes the effect of betuline acid on the methilation of promotor regions of some gene, primarialy the genes from the P53 pathway. This data was generated by students from Hanzehogeschool groningen.


*Nov 20 2024*

I recieved the data from the project manager, the data consist of two types of csv files: All reads or only regions of interest.

The All read files consist of 5 columns: chromosome, start and end position (which always seem to only include only 1 position.), a frac column and a valid column.

The regions of interest files have 3 columns: chromosome, position and gene.

In barcodes.csv are the types of patients given for each barcode (heathy, control, etc.).

Er staat geen gene colom in de all read files, wat vervelend is voor het filteren, Ramon Reilman (medestudent) heeft hier al een mail over gestuurt, dus als hij een reactie krijgt geeft hij dat door aan mij.

*Nov 21 2024*

Nu wil ik de data alsnog even op mijn repo hebben onder in de map 'data'. Dus ik copieer de data naar mijn repository ook al kan er een verandering aan komen, maar dan kopieer ik het wel opnieuw.

ik gebruik de code:
```{bash eval = FALSE}
scp user@bioinf.nl:/commons/Themas/Thema06/Methylatie/analysis ./
scp user@bioinf.nl:/commons/Themas/Thema06/Methylatie/barcodes.csv ./
```

Als visualisatie zat ik in ieder geval te denken aan het selecteren van een of meerdere chromosomen en een range van posities voor de promoter regio's. Na die selectie zou het waarschijnlijk fijn zijn om niet alle chromosomen tegelijk te zien, dus dan zou je kunnen wisselen tussen chromosoom visualisaties met een dropdown menu of iets. De plot die dan gevisualiseert wordt zou dan waarschijnlijk een barchart zijn met op de x-as de positie en op de y-as een %gemetileert of readcounts.

*Nov 26 2024*

Ik heb de bestanden met git lfs naar de git repository gepushed. Ik ga hier verder met het kijken naar de visualisatie van de bestanden:

Geef mijn al gegenereerde venv met [reticulate](https://rviews.rstudio.com/2019/06/10/reticulate-virtualenv-and-python-in-linux/):
```{r}
library("reticulate")
```


```{r}
use_virtualenv("../venv")
py_config()
matplotlib <- import("matplotlib")
matplotlib$use("Agg", force = TRUE)
```

Importeer de benodigde library's:
```{python}
import pandas as pd
import matplotlib as mpl
import numpy as np
import os
```

data inlezen
```{python}
bar_11_ALL = pd.read_csv("../Data/analysis/barcode11_methylatie_ALL.csv", sep="\t")
print(bar_11_ALL.head(10))
```

```{python}
bar_11_ROI = pd.read_csv("../Data/analysis/barcode11.methylatie_ROIs.csv", sep="\t", header=0, usecols=[0,1,2], names=["chr", "pos", "gene"])
print(bar_11_ROI.head(10))
```

Ik geef de colomen zelf op omdat bij de ROI data wordt de gene colom naam naar een NaN colom geschoven en de gene colom unnamed wordt.

Ik kan alle ROI en ALL data waarschijnlijk in een lijst of dictionary opslaan, ik ga dit alleen doen met de ROI's omdat die heel weinig informatie hebben en ik makkelijk op mijn eigen laptop kan processen.

Hiervoor wil ik de absolte paden hebben om de bestanden in te lezen. Dit kan ik doen met de config, maar ik kan met os misschien die ook zelf genereren:

```{python}
ROI_paths = [os.path.abspath(os.path.join("../Data/analysis/", path)) for path in os.listdir("../Data/analysis/") if path.endswith("ROIs.csv")]
print(ROI_paths)
ALL_paths = [os.path.abspath(os.path.join("../Data/analysis/", path)) for path in os.listdir("../Data/analysis/") if path.endswith("ALL.csv")]
print(ALL_paths)
```

Dit werkt, ik gebruik dezelfde code wel twee keer dus ik kan deze als een functie in mijn bestand zetten.

Ik wil deze bestanden wel in een enkele dataframe, met een extra colom die aangeeft van welke barcode het komt. Dit is makelijker als ik deze data als dict maak met de key's de barcode:

```{python}
# index op het absolute pad met negatieve waardes zodat mogelijke afwijkingen in het pad niet relevant is voor het indexen op de string.
ROI_data = {file[-29:-20]: (pd.read_csv(file, sep="\t", header=0, usecols=[0,1,2], names=["chr", "pos", "gene"])) for file in ROI_paths}

print(ROI_data)
```
Om een of andere reden is barcode 12 ROI leeg, en is er een rare volgorde van de barcodes, maar dat zou niet uit moeten maken.









